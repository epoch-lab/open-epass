# 无状态的邮件验证

目标：服务端不存储状态，验证邮件不包含 URL，并且验证码尽可能短

思路：类似于 TOTP

1. 用户输入 Email 地址后，调用服务端 Email 验证接口
2. Email 验证接口中，
   1. 计算当前时间戳（毫秒） / 600000（10 分钟）称为 `Time Window`
   2. 拼接 Email 地址、当前时间戳（毫秒） / 600000（10 分钟），称为 `Msg`
   3. 使用配置的 `Server Secret` 对 `Msg` 进行 HMAC-SHA256，称为 `Full Code`
   4. 截断 `Full Code` 的前 6 位，作为验证码
   5. 发送验证码到邮箱
3. 用户输入验证码后，调用注册接口
4. 注册接口中，
   1. 进行上面所述的计算，得到 `Time Window` 和 `Time Window` - 1 对应的验证码（多延展一个时间窗口，防止卡点过期）
   2. 判断是否一致
